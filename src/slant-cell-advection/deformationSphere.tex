\subsection{Deformational flow on a sphere}
\label{sec:deformationSphere}

To ensure that the cubicFit transport scheme is suitable for complex flows on a variety of meshes, we use a standard test of deformational flow on a spherical Earth \citep{lauritzen2012}.  
Results are compared between linearUpwind and cubicFit schemes using hexagonal icosahedra and cubed-spheres.
Hexagonal-icosahedral meshes are constructed by successive refinement of a regular icosahedron following the approach by \citep{thuburn2014}.
Figure~\ref{fig:sphere-meshes}a shows an example of such a mesh that has been refined three times.
Cubed-sphere meshes are constructed using an equi-distant gnomic projection of a cube having a uniform Cartesian mesh on each panel \citep{staniforth-thuburn2012}.
Figure~\ref{fig:sphere-meshes}b shows an example of a cubed-sphere mesh having panels with $8 \times 8$ cells.

\begin{figure}
	\centering
	\includegraphics{../fig-deformationSphere-meshes/fig-deformationSphere-meshes.pdf}
	\caption{Illustrations of coarse meshes of a spherical Earth using (a) a hexagonal icosahedron that has been refined three times, and (b) a cubed-sphere with each panel having $8 \times 8$ cells.}
	\label{fig:sphere-meshes}
\end{figure}

Following appendix A9 in \citep{lauritzen2014}, the average equatorial spacing $\Delta \lambda$ is used as a measure of mesh spacing.  It is defined as
\begin{align}
	\Delta \lambda = \ang{360} \frac{\overline{\Delta x}}{2 \pi R_e}
\end{align}
where $\overline{\Delta x}$ is the mean distance between cell centres and $R_e = \SI{6.3712e6}{\meter}$ is the radius of the Earth.

The deformational flow test in \citep{lauritzen2012} comprised six elements:
\begin{enumerate}
\item a convergence test using a Gaussian-shaped tracer
\item a ``minimal'' resolution test using a cosine-shaped tracer
\item a test of filament preservation
\item a test using a ``rough'' slotted cylinder tracer
\item a test of correlation preservation between two tracers
\item a test using a divergent velocity field
\end{enumerate}
We assess the cubicFit scheme using the first two tests only.  We do not consider filament preservation, correlation preservation, or the transport of a ``rough'' slotted cylinder because no shape-preserving filter has yet been developed for cubicFit.  Stable results were obtained when testing cubicFit using a divergent velocity field, but no further analysis is made here.  \TODO{provide results as supplementary material?}

The first deformational flow test uses a $C^\infty$ initial tracer that is transported in a non-divergent, time-varying rotational velocity field.
The velocity field deforms two Gaussian `hills' of tracer into thin vortical filaments.  Half-way through the integration the rotation reverses so that the filaments become circular hills once again.  The analytic solution at the end of integration is identical to the initial condition.
A rotational flow is superimposed on a time-invariant background flow in order to avoid error cancellation.
The non-divergent velocity field is defined by the streamfunction $\Psi$:
\begin{align}
	\Psi(\lambda, \theta, t) = \frac{10 R_e}{T} \sin^2 \left(\lambda'\right) \cos^2 \left(\theta\right) \cos \left( \frac{\pi t}{T} \right) - \frac{2 \pi R_e}{T} \sin\left(\theta\right)
\end{align}
where $\lambda$ is a longitude, $\theta$ is a latitude, $T = \SI{1.0368e6}{\second}$ is the duration of integration, and $\lambda' = \lambda - 2 \pi t / T$.

The initial tracer $\phi$ is defined as the sum of two Gaussian hills:
\begin{align}
	\phi = \phi_1(\lambda, \theta) + \phi_2(\lambda, \theta)
\end{align}
An individual hill $\phi_i$ is given by
\begin{align}
	\phi_i(\lambda, \theta) = \phi_0 \exp\left( -b \left( \frac{|\mathbf{x} - \mathbf{x}_i|}{R_e} \right)^2 \right)
\end{align}
where $\phi_0 = 0.95$ and $b = 5$.  The Cartesian position vector $\mathbf{x} = (x,y,z)$ is related to the spherical coordinates $(\lambda, \theta)$ by
\begin{align}
	(x,y,z) = (R_e \cos \theta \cos \lambda, R_e \cos \theta \sin \lambda, R_e \sin \theta) \label{eqn:spherical-cartesian}
\end{align}
The centre of hill $i$ is positioned at $\mathbf{x}_i$.  In spherical coordinates, two hills are centred at
\begin{align}
	(\lambda_1,\theta_1) &= (5 \pi /6, 0) \\
	(\lambda_2,\theta_2) &= (7 \pi /6, 0)
\end{align}

\begin{figure}
	\centering
	\includegraphics{../fig-deformationSphere-initialTracer/fig-deformationSphere-initialTracer.pdf}
	\caption{Tracer fields for the deformational flow test using initial Gaussian hills.  The tracer is deformed by the velocity field before the rotation reverses to return the tracer to its original distribution: (a) the initial tracer distribution at $t = \SI{0}{\second}$; (b) by $t=T/2$ the Gaussian hills are stretched into a thin S-shaped filament; (c) at $t=T$ the tracer resembles the initial Gaussian hills except for some distortion and diffusion due to numerical errors.
	\TODO{plot at a high resolution hex mesh.}}
	\label{fig:deformationSphere-evolution}
\end{figure}

The results in figure~\ref{fig:deformationSphere-evolution} are obtained using the cubicFit scheme on \TODO{whatever high-res mesh I choose}.  The initial Gaussian hills are shown in figure~\ref{fig:deformationSphere-evolution}a.  At $t=T/2$ the tracer has been deformed into an S-shaped filament (figure~\ref{fig:deformationSphere-evolution}b).  By $t=T$ the tracer has almost returned to its original distribution except for some distortion and diffusion that are the result of numerical errors (figure~\ref{fig:deformationSphere-evolution}c).

\begin{figure}
	\centering
	\includegraphics{../fig-deformationSphere-gaussiansConvergence/fig-deformationSphere-gaussiansConvergence.pdf}
	\caption{\TODO{deformational flow l2 and linf convergence plots comparing cubed sphere and hexagons, cubicFit and linearUpwind.  This figure is comparable to \citet{lauritzen2012} figure 4.}}
\end{figure}

\TODO{``Minimal'' resolution using cosine bells}

\TODO{what motivates us to perform this test?}

The non-divergent velocity field is the same as convergence test in section~\ref{sec:deformationSphere-gaussian-nondiv}.  A quasi-smooth tracer field is defined as the sum of two cosine bells:
\begin{align}
	\phi =
	\begin{cases}
		b + c \phi_1(\lambda, \theta) & \quad \text{if $r_1 < r$} \\
		b + c \phi_2(\lambda, \theta) & \quad \text{if $r_2 < r$} \\
		b			      & \quad \text{otherwise}
	\end{cases}
\end{align}

\begin{figure}
	\centering
	\includegraphics{../fig-deformationSphere-cosBellsConvergence/fig-deformationSphere-cosBellsConvergence.pdf}
	\caption{\TODO{$\ell_2$ convergence for non-divergent deformational flow using Cosine bells.  Used to find ``minimal'' resolution.  Plot for hexagons and cubed sphere, cubicFit and linearUpwind.  Plot a heavy line for minimal resolution, as in \citet{lauritzen2012} figure 5.}}
\end{figure}

